# Web管理界面 - 自动发货功能使用指南

## 功能概述

通过Web管理界面，您可以轻松配置和管理虚拟商品的自动发货功能，查看发货记录和统计数据。

## 功能入口

### 1. 商品编辑页面 - 配置发货

**路径**: `商品管理 → 商品列表 → 点击商品 → 自动发货 Tab`

在商品编辑页面，您会看到三个Tab：
- **基本信息** - 商品的基础信息编辑
- **AI提示词** - 配置智能客服提示词
- **自动发货** ⭐ - 配置自动发货信息

### 2. 发货记录页面

**路径**: `商品管理 → 发货记录`

查看所有的自动发货记录、统计信息和发货状态。

---

## 配置步骤

### 步骤1: 进入商品编辑页面

1. 进入 `商品管理 → 商品列表`
2. 找到需要配置自动发货的商品
3. 点击商品卡片或操作按钮进入编辑页面
4. 点击 `自动发货` Tab

### 步骤2: 配置发货信息

#### 2.1 启用自动发货
- 打开 `启用自动发货` 开关（默认开启）

#### 2.2 选择发货类型

**网盘链接**（推荐）
```
适用场景：软件、课程、资料等大文件
配置项：
- 网盘链接：输入百度网盘、阿里云盘等链接
- 提取码：输入网盘提取码（可选）
```

**卡密**
```
适用场景：激活码、兑换码、会员卡等
配置项：
- 卡密：输入完整的卡密信息
```

**自定义文本**
```
适用场景：其他需要自定义发货内容的场景
配置项：
- 发货内容：自由输入任何文本内容
```

#### 2.3 设置库存

- **无限库存** (推荐): 设置为 `-1`
  - 适用于可重复发货的虚拟商品（如网盘链接）

- **有限库存**: 设置具体数字（如 `100`）
  - 适用于卡密等有限资源
  - 每次发货自动减1
  - 库存为0时不会自动发货

#### 2.4 自定义消息模板（可选）

如果默认发货消息不满足需求，可以自定义消息模板。

**支持的变量**：
- `{content}` - 发货内容（网盘链接/卡密等）
- `{code}` - 提取码
- `{title}` - 商品标题
- `{price}` - 商品价格

**示例模板**：
```
亲爱的客户，您购买的【{title}】已发货！

📦 网盘链接：{content}
🔑 提取码：{code}
💰 实付：{price}元

感谢支持，祝您使用愉快！
```

### 步骤3: 保存配置

1. 填写完所有必填项
2. 在 `发货消息预览` 区域查看效果
3. 点击 `保存配置` 按钮
4. 等待提示 "发货配置保存成功"

---

## 界面功能说明

### 商品编辑 - 自动发货Tab

#### 顶部操作按钮
- **重新加载** - 刷新配置数据
- **删除配置** - 删除当前商品的发货配置

#### 配置表单
| 字段 | 说明 | 必填 |
|------|------|------|
| 启用自动发货 | 开关控制是否启用 | 否 |
| 发货类型 | 网盘/卡密/文本三选一 | 是 |
| 网盘链接 | 输入有效URL | 是（网盘类型） |
| 提取码 | 最多10个字符 | 否 |
| 卡密 | 最多500字符 | 是（卡密类型） |
| 发货内容 | 最多1000字符 | 是（文本类型） |
| 库存数量 | -1表示无限 | 是 |
| 自定义消息模板 | 最多1000字符 | 否 |

#### 发货消息预览
实时预览发货消息的最终效果，帮助您确认配置是否正确。

---

### 发货记录页面

#### 统计卡片（顶部）
- **发货配置数** - 已配置自动发货的商品数量
- **已启用配置** - 当前启用的配置数量
- **总发货次数** - 累计自动发货次数
- **发货成功率** - 成功发货的百分比

#### 筛选功能
- **搜索商品ID** - 查看特定商品的发货记录
- **搜索买家ID** - 查看特定买家的购买记录
- **状态筛选** - 筛选成功/失败的记录
- **刷新按钮** - 刷新数据

#### 记录表格
| 列 | 说明 |
|---|---|
| ID | 发货记录唯一标识 |
| 商品ID | 可点击复制 |
| 买家ID | 可点击复制 |
| 发货类型 | 网盘/卡密/文本 |
| 发货内容 | 鼠标悬停查看完整内容 |
| 发货时间 | 精确到秒 |
| 状态 | 成功/失败标签 |
| 错误信息 | 失败时显示原因 |

#### 表格功能
- **排序** - 点击列标题排序
- **筛选** - 按状态筛选
- **分页** - 支持10/20/50/100条每页
- **导出** - 导出记录数据（待开发）

---

## 使用场景示例

### 场景1: 配置网盘类商品

**商品**: Python教程视频合集
**配置**:
```
发货类型: 网盘链接
网盘链接: https://pan.baidu.com/s/1example123
提取码: py01
库存数量: -1 (无限)
自定义消息: (留空，使用默认模板)
```

**买家收到**:
```
您好！感谢购买，以下是商品资源：

📦 网盘链接：https://pan.baidu.com/s/1example123
🔑 提取码：py01

请及时保存，如有问题请随时联系我。祝您使用愉快！
```

### 场景2: 配置卡密类商品

**商品**: 某平台会员卡
**配置**:
```
发货类型: 卡密
卡密: ABCD-1234-EFGH-5678
库存数量: 50 (有限库存)
```

**买家收到**:
```
您好！感谢购买，以下是您的卡密信息：

🎟️ 卡密：ABCD-1234-EFGH-5678

请妥善保管，如有问题请随时联系我。
```

### 场景3: 自定义模板

**商品**: 在线课程
**配置**:
```
发货类型: 网盘链接
网盘链接: https://pan.baidu.com/s/course123
提取码: abc
自定义消息:
🎓 亲，您购买的【{title}】课程资源来啦！

📚 下载地址：{content}
🔐 提取码：{code}
💰 实付金额：{price}元

⭐ 学习建议：
1. 建议按顺序学习
2. 配合实践效果更佳
3. 遇到问题随时咨询

祝您学习愉快！
```

---

## 常见问题

### Q1: 如何测试自动发货？
**A**: 可以在闲鱼下一个小额测试订单，付款后查看发货记录页面验证。

### Q2: 配置保存后什么时候生效？
**A**: 立即生效。下一个付款订单就会自动发货。

### Q3: 可以临时禁用某个商品的自动发货吗？
**A**: 可以。关闭 "启用自动发货" 开关并保存即可。

### Q4: 库存不足会怎样？
**A**: 系统会给买家发送 "抱歉，该商品暂时缺货，请联系卖家处理" 的消息，并记录发货失败。

### Q5: 如何查看某个商品的发货情况？
**A**: 进入 "发货记录" 页面，在 "搜索商品ID" 框输入商品ID查询。

### Q6: 发货失败的原因有哪些？
**A**: 常见原因：
- 未配置发货信息
- 发货功能被禁用
- 库存不足
- 系统错误（网络问题等）

### Q7: 可以修改已发送的发货消息吗？
**A**: 无法修改已发送的消息。建议配置前在预览区域仔细检查。

### Q8: 支持批量配置吗？
**A**: 目前需要逐个商品配置。批量配置功能在规划中。

---

## 最佳实践建议

### 1. 配置前准备
✅ 确保网盘链接永久有效
✅ 测试链接是否可以正常访问
✅ 准备好提取码（如需要）
✅ 检查商品标题和价格是否正确

### 2. 消息模板建议
✅ 使用友好的称呼（如"亲"、"您好"）
✅ 使用表情符号增强可读性
✅ 包含必要的使用说明
✅ 留下联系方式
✅ 表达感谢

### 3. 库存管理
✅ 虚拟商品建议设置无限库存
✅ 卡密类商品及时补充库存
✅ 定期检查库存状态
✅ 库存不足时及时下架商品

### 4. 日常维护
✅ 定期检查发货记录
✅ 关注发货成功率
✅ 及时处理失败记录
✅ 更新过期的网盘链接

---

## 技术支持

- **文档位置**: `/docs/AUTO_DELIVERY_GUIDE.md`
- **后端文档**: `XianyuAutoAgent/docs/AUTO_DELIVERY.md`
- **测试脚本**: `XianyuAutoAgent/examples/test_auto_delivery.py`

如有问题，请查看后端日志或联系技术支持。

---

## 更新日志

### v1.0.0 (2024-11-12)
- ✅ 支持网盘链接、卡密、自定义文本三种发货类型
- ✅ 支持自定义消息模板
- ✅ 支持库存管理
- ✅ 发货记录查询和统计
- ✅ 实时发货消息预览
- ✅ 响应式设计，支持移动端

---

**祝您使用愉快！**
